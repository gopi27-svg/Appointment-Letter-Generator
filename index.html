<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Appointment Letter Generator — USDC (Neumorphic Multi-Select)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-main: #eef2f9;
      --primary-brand: #3b82f6; /* Blue */
      --secondary-brand: #10b981; /* Emerald */
      --text-dark: #334155;
      --text-muted: #64748b;
      --shadow-light: #ffffff;
      --shadow-dark: #d1d9e6;
      --radius: 20px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background-color: var(--bg-main);
      color: var(--text-dark);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    /* Neumorphic Shadows */
    .neumorphic-convex {
        box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    }
    .neumorphic-concave {
        box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
    }

    /* Header with Large Logo */
    .app-header {
      background: var(--bg-main);
      border-radius: var(--radius);
      padding: 32px;
      text-align: center;
      margin-bottom: 40px;
    }

    .company-logo {
      display: block;
      max-width: 590px; /* large as requested */
      width: 100%;
      height: auto;
      margin: 0 auto 24px;
      border-radius: 45px;
      transition: transform 0.3s ease;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
    }
    .company-logo:hover { transform: scale(1.02); }

    .app-header .title {
      font-size: clamp(24px, 4vw, 40px);
      font-weight: 800;
      color: var(--text-dark);
    }

    /* Card */
    .card {
      background: var(--bg-main);
      border-radius: var(--radius);
      padding: 32px;
      margin-bottom: 32px;
    }

    h2 {
      margin: 0 0 8px;
      font-size: 22px;
      font-weight: 700;
    }
    
    .card-description {
        margin: -8px 0 24px;
        color: var(--text-muted);
        font-size: 15px;
    }

    .actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      border: none;
      border-radius: 12px;
      padding: 12px 20px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: box-shadow 0.2s ease;
      background: var(--bg-main);
      color: var(--text-dark);
    }
    .btn:active {
      box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
    }
    .btn.primary { color: var(--primary-brand); }
    .btn.secondary { color: var(--secondary-brand); }
    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
      color: var(--text-muted);
      box-shadow: none;
    }
    .btn:disabled:active { box-shadow: none; }
    .btn .icon { display: inline-block; width: 20px; height: 20px; }

    /* Drag & Drop */
    .drop {
      margin-top: 24px;
      border-radius: var(--radius);
      padding: 40px;
      text-align: center;
      color: var(--text-muted);
      transition: all 0.2s ease;
      cursor: pointer;
      min-height: 140px;
    }
    .drop .icon { margin: 0 auto 12px; display: block; width: 36px; height: 36px; color: var(--text-muted); transition: color 0.2s ease;}
    .drop.highlight, .drop:hover { background: #e6eaf1; }
    .drop:hover .icon { color: var(--primary-brand); }
    .drop-text { font-weight: 600; font-size: 16px; color: var(--text-dark); }
    .drop-hint { font-size: 14px; margin-top: 4px; }
    .muted { color: var(--text-muted); font-size: 14px; }

    /* Table */
    .tablewrap {
      max-height: 480px;
      overflow: auto;
      border-radius: var(--radius);
      padding: 8px;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 4px;
      font-size: 14px;
    }
    th, td {
      padding: 14px 18px;
      text-align: left;
      background: var(--bg-main);
      border-top: 1px solid #e2e8f0;
      border-bottom: 1px solid #e2e8f0;
    }
    tr td:first-child, tr th:first-child { border-radius: 10px 0 0 10px; border-left: 1px solid #e2e8f0; }
    tr td:last-child, tr th:last-child { border-radius: 0 10px 10px 0; border-right: 1px solid #e2e8f0; }
    thead th {
      position: sticky; top: 0; background: var(--bg-main);
      font-weight: 700; text-transform: uppercase; font-size: 12px; letter-spacing: 0.8px; border: none; padding-bottom: 12px;
    }
    tbody tr { transition: transform 0.2s ease, box-shadow 0.2s ease; }
    tbody tr:hover { transform: scale(1.01); box-shadow: 4px 4px 10px var(--shadow-dark), -4px -4px 10px var(--shadow-light); }

    /* checkbox accent */
    td input[type="checkbox"] {
        accent-color: var(--primary-brand);
        vertical-align: middle;
        transform: scale(1.2);
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="app-header neumorphic-convex">
      <img src="https://i.postimg.cc/44S4b7jP/USDC-Theme.jpg" alt="USDC Logo" class="company-logo"/>
      <div class="title">Appointment Letter Generator</div>
    </header>

    <main>
      <section class="card neumorphic-convex">
          <h2>Step 1 — Upload Data</h2>
          <p class="card-description">Download the sample template, then upload your Excel file to begin.</p>
          <div class="actions">
            <button class="btn secondary neumorphic-convex" id="downloadSampleBtn">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
              <span>Download Sample .xlsx</span>
            </button>
            <button class="btn primary neumorphic-convex" id="browseBtn">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M15 11.25V18a2.25 2.25 0 01-2.25 2.25H11.25m-2.25-4.5v-1.5a2.25 2.25 0 012.25-2.25H15M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              <span>Choose File…</span>
            </button>
            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display:none"/>
          </div>
          <div id="drop" class="drop neumorphic-concave">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15m0-3l-3-3m0 0l-3 3m3-3v12" /></svg>
            <div class="drop-text">Drag & Drop Your File Here</div>
            <div class="drop-hint">or click "Choose File"</div>
          </div>
          <div id="sheetInfo" class="muted" style="margin-top:16px;"></div>
      </section>

      <section class="card neumorphic-convex">
          <h2>Step 2 — Generate PDFs</h2>
          <p class="card-description">Create letters for all rows, or tick multiple rows below and generate only those employees.</p>
          <div class="actions">
            <button class="btn primary neumorphic-convex" id="genAllBtn" disabled>
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 013.75 9.375v-4.5zM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 01-1.125-1.125v-4.5zM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0113.5 9.375v-4.5zM13.5 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 01-1.125-1.125v-4.5z" /></svg>
              <span>Generate PDFs for All Rows</span>
            </button>
            <button class="btn secondary neumorphic-convex" id="genSelectedBtn" disabled>
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              <span>Generate PDFs for Selected Rows</span>
            </button>
          </div>
          <div id="genStatus" class="muted" style="margin-top:16px;"></div>
      </section>

      <section class="card neumorphic-convex">
        <h2>Step 3 — Preview Data</h2>
        <p class="card-description">Review your data below. Tick any number of rows to generate PDFs for only those employees.</p>
        <div id="tableWrap" class="tablewrap neumorphic-concave">
            <div style="text-align:center; padding: 60px; color: var(--text-muted);">Please upload a file to preview your data.</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxPWxPZYDJuIqRI4GXyCUY9yKPoSrmkJeu6OQO6bMFwJvWBRvDhixMMzY6SEN_7pQsc/exec";
    const SAMPLE_XLSX_BASE64 = "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";
    const SAMPLE_FILE_NAME = "Appointment_Sample.xlsx";

    // Columns to show in Preview (with mapping + fuzzy)
    const COLUMNS = [
      { canonical: "Date of Joining", display: "Date of Joining",
         aliases: ["Date of Joining","DOJ","Date of Joining "], fuzz: [["date","joining"],["doj"]] },
      { canonical: "EMPLOYEE FULL NAME", display: "Employee Name",
         aliases: ["EMPLOYEE FULL NAME","Employee Full Name","EMPLOYEE NAME","Employee Name","Name"], fuzz: [["employee","name"],["emp","name"],["name"]] },
      { canonical: "Designation", display: "Designation",
         aliases: ["Designation","DESIGNATION IN OFFER LETTER","Designation "], fuzz: [["designation"],["designation","offer"]] },
      { canonical: "Location", display: "Location",
         aliases: ["Location","Place of Posting","Work Location"], fuzz: [["location"],["place","posting"],["work","location"]] },
      { canonical: "Total Gross", display: "Monthly Gross",
         aliases: ["Total Gross","Monthly Gross","GROSS"], fuzz: [["total","gross"],["monthly","gross"]] },
      { canonical: "Cost to Company_PM", display: "Monthly CTC",
         aliases: ["Cost to Company_PM","Monthly CTC","Cost to Company","CTC"], fuzz: [["cost","company"],["monthly","ctc"],["ctc"]] },
      { canonical: "Total Gross Salary_PA", display: "Annual Gross",
         aliases: ["Total Gross Salary_PA","Total Gross (12)","Total Gross Salary (12)"], fuzz: [["total","gross","12"]] },
      { canonical: "Annual CTC", display: "Annual CTC",
         aliases: ["Annual CTC","Cost to Company (12)","CTC (12)"], fuzz: [["annual","ctc"],["ctc","12"]] }
    ];

    const $ = id => document.getElementById(id);

    function dlSample() {
      if(!SAMPLE_XLSX_BASE64) return alert("Sample not embedded.");
      const bin = Uint8Array.from(atob(SAMPLE_XLSX_BASE64), c=>c.charCodeAt(0));
      const blob = new Blob([bin], {type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});
      const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = SAMPLE_FILE_NAME || "Sample.xlsx";
      document.body.appendChild(a); a.click(); setTimeout(()=>{URL.revokeObjectURL(a.href); a.remove();},600);
    }

    window.addEventListener("DOMContentLoaded", () => {
      $("downloadSampleBtn").addEventListener("click", dlSample);

      const drop = $("drop");
      const fileInput = $("fileInput");
      const browseBtn = $("browseBtn");

      browseBtn.addEventListener("click", ()=> fileInput.click());
      fileInput.addEventListener("change", (e)=>{ if(e.target.files && e.target.files.length) readWorkbookFile(e.target.files[0]); });

      ["dragenter","dragover"].forEach(ev=> drop.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add("highlight"); }));
      ["dragleave","drop"].forEach(ev=> drop.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove("highlight"); }));
      drop.addEventListener("drop", (e)=>{ const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0]; if(f) readWorkbookFile(f); });
      drop.addEventListener("click", ()=> fileInput.click());

      $("genAllBtn").addEventListener("click", ()=>generate(false));
      $("genSelectedBtn").addEventListener("click", ()=>generate(true));
    });

    async function readWorkbookFile(f){
      try{
        const data = await f.arrayBuffer();
        const wb = XLSX.read(data, {type:"array"});
        const first = wb.SheetNames[0];
        const rawRows = XLSX.utils.sheet_to_json(wb.Sheets[first], {defval:""});
        const rows = normalizeRows(rawRows);
        window._rows = rows;
        window._selectedRows = []; // reset selection on new load

        $("sheetInfo").textContent = rows.length + " rows loaded from “" + first + "”.";

        // <<< New: show success message in drop zone instead of blank >>>
        $("drop").innerHTML = `
          <div style="padding: 24px; text-align:center; font-size:15px; font-weight:700; color:#0f8e63;">
            ✅ File uploaded successfully<br/>
          </div>
        `;

        renderTable(rows);
        updateButtons();
      }catch(err){
        $("sheetInfo").textContent = "Failed to read file: " + (err.message || err);
      }
    }

    function normalizeRows(rows){
      const normKey = k => String(k||"").replace(/\s+/g," ").trim().toLowerCase();
      return rows.map(r=>{
        const keyMap = {}, out = {};
        Object.keys(r).forEach(k=>{ keyMap[normKey(k)] = k; out[k.trim()] = r[k]; });
        COLUMNS.forEach(col=>{
          let val = ""; let hitKey = null;
          for(const al of col.aliases){ const nk = normKey(al); if(keyMap[nk] !== undefined){ hitKey = keyMap[nk]; val = r[hitKey]; if(String(val).trim()!=="") break; } }
          if(String(val).trim()===""){ // fuzzy
            const keys = Object.keys(keyMap);
            for(const set of (col.fuzz||[])){
              const tokens = set.map(t=>String(t).toLowerCase());
              const found = keys.find(klo=> tokens.every(t=> klo.includes(t)));
              if(found){ hitKey = keyMap[found]; val = r[hitKey]; if(String(val).trim()!=="") break; }
            }
          }
          out[col.canonical] = (val===undefined || val===null) ? "" : val;
        });
        return out;
      });
    }

    function renderTable(rows){
      const headers = COLUMNS.map(c=>c.display);
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const thr = document.createElement("tr");
      thr.innerHTML = "<th>Select</th>" + headers.map(h=>"<th>"+h+"</th>").join("");
      thead.appendChild(thr); table.appendChild(thead);

      const tbody = document.createElement("tbody");
      rows.forEach((r, idx)=>{
        const tr = document.createElement("tr");
        const first = '<td><input aria-label="Select row" type="checkbox" onchange="toggleRow('+idx+', this.checked)"></td>';
        const tds = COLUMNS.map(c=>{
          let val = (r[c.canonical] !== undefined && r[c.canonical] !== null) ? r[c.canonical] : "";
          if(c.canonical === "Date of Joining" && val) val = formatDate(val);
          return "<td>"+ val +"</td>";
        }).join("");
        tr.innerHTML = first + tds;
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      document.getElementById("tableWrap").innerHTML = "";
      document.getElementById("tableWrap").appendChild(table);
    }

    function toggleRow(index, checked){
      window._selectedRows = Array.isArray(window._selectedRows) ? window._selectedRows : [];
      if(checked) {
        if(!window._selectedRows.includes(index)) window._selectedRows.push(index);
      } else {
        window._selectedRows = window._selectedRows.filter(i => i !== index);
      }
      updateButtons();
    }

    function formatDate(v){
      try{
        let d;
        if(typeof v === "number"){
          const base = new Date(1899,11,30);
          d = new Date(base.getTime() + v*86400000);
        } else {
          const s = String(v).trim();
          let m = s.match(/^([0-3]?\d)[-/]([0-1]?\d)[-/](\d{4})$/);
          if(m) d = new Date(parseInt(m[3],10), parseInt(m[2],10)-1, parseInt(m[1],10));
          if((!d || isNaN(d))) m = s.match(/^(\d{4})-([0-1]?\d)-([0-3]?\d)$/);
          if(m && (!d || isNaN(d))) d = new Date(parseInt(m[1],10), parseInt(m[2],10)-1, parseInt(m[3],10));
          if(!d || isNaN(d)) d = new Date(s);
        }
        if(isNaN(d)) return v;
        const day = d.getDate();
        const suf = (day%10===1&&day%100!==11)?"st":(day%10===2&&day%100!==12)?"nd":(day%10===3&&day%100!==13)?"rd":"th";
        const mon = d.toLocaleString("en-US", {month:"long"});
        return day + suf + " " + mon + " " + d.getFullYear();
      }catch(e){ return v; }
    }

    function updateButtons(){
      const hasRows = Array.isArray(window._rows) && window._rows.length>0;
      const hasSel  = Array.isArray(window._selectedRows) && window._selectedRows.length>0;
      document.getElementById("genAllBtn").disabled = !hasRows;
      document.getElementById("genSelectedBtn").disabled = !hasRows || !hasSel;
    }

    async function generate(onlySelected){
      const rows = onlySelected
        ? (window._selectedRows || []).map(i => window._rows[i])
        : window._rows;
      if(!rows || !rows.length) return alert("No rows to generate.");
      document.getElementById("genStatus").textContent="Generating…";
      try{
        const res = await fetch(BACKEND_URL,{ method:"POST", headers:{"Content-Type":"text/plain;charset=utf-8"}, body: JSON.stringify({rows, filenamePrefix:""}) });
        const data = await res.json();
        if(!data.ok) throw new Error(data.error||"Unknown error");
        const bin = Uint8Array.from(atob(data.base64),c=>c.charCodeAt(0));
        const blob = new Blob([bin],{type:data.mimeType});
        const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = data.filename || (onlySelected?"Selected_Letters.zip":"Letters.zip");
        document.body.appendChild(a); a.click(); setTimeout(()=>{URL.revokeObjectURL(a.href); a.remove();},600);
        document.getElementById("genStatus").textContent = "Done — download started.";
      }catch(e){ document.getElementById("genStatus").textContent = "Failed: " + (e.message || e); }
    }
  </script>
</body>
</html>
